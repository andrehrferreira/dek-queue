{"version":3,"sources":["../src/index.js"],"names":["Queue","name","timeout","timer","block","queue","promise","data","push","v","cb","length","key","shift","Date","getTime","setTimeout","setParser","setInterval","Queues","queues","$","set"],"mappings":"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","file":"index.js","sourcesContent":["import { $ } from \"@dekproject/scope\";\n\nclass Queue {\n    constructor(name) {\n        this.name = name;\n        this.timeout = 1000;\n        this.timer = null;\n        this.block = 1;\n        this.queue = [];\n        this.promise = false;\n    }\n\n    push(data){\n        this.queue.push(data);\n        return this;\n    }\n\n    setTimeout(v){\n        if(typeof v == \"number\")\n            this.timeout = v;\n\n        return this;\n    }\n\n    setBlock(v){\n        if(typeof v == \"number\")\n            this.block = v;\n\n        return this;\n    }\n\n    returnPromise(v){\n        if(typeof v == \"boolean\")\n            this.promise = v;\n\n        return this;\n    }\n\n    async setParser(cb){\n        if(this.promise){\n            try{\n                if(this.queue.length > 0){\n                    let data = [];\n\n                    for(let key = 0; key < this.block; key++){\n                        if(this.queue.length > 0){\n                            data.push(this.queue[0]);\n                            this.queue.shift();\n                        }\n                        else{\n                            break;\n                        }\n                    }\n\n                    if(data.length > 0){\n                        await cb(data, this.queue.length, new Date().getTime());\n                    }\n                }\n            }\n            catch(e){ }\n\n            setTimeout((cb) => { this.setParser(cb); }, this.timeout, cb);\n        }\n        else{\n            this.timer = setInterval(async () => {\n                try{\n                    if(this.queue.length > 0){\n                        let data = [];\n\n                        for(let key = 0; key < this.block; key++){\n                            if(this.queue.length > 0){\n                                data.push(this.queue[0]);\n                                this.queue.shift();\n                            }\n                            else{\n                                break;\n                            }\n                        }\n\n                        if(data.length > 0)\n                            cb(data, this.queue.length, new Date().getTime());\n                    }\n                }\n                catch(e){ }\n            }, this.timeout);\n        }\n    }\n}\n\nclass Queues{\n    constructor() {\n        this.queues = {};\n    }\n\n    subscribe(name){\n        if(typeof this.queues[name] !== \"object\")\n            this.queues[name] = new Queue(name);\n\n        return this.queues[name];\n    }\n}\n\nexport default () => {\n    $.set(\"queue\", new Queues());\n}\n"]}